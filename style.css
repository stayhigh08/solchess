:root {
    --primary-purple: #9370DB;
    --near-black: #0D0D0D;
    --card-black: #1A1A1A;
    --grid-color: rgba(147, 112, 219, 0.05);
    --light-square: rgba(234, 234, 234, 0.1);
    --dark-square: #4a096157;
    --highlight-color: rgba(255, 223, 0, 0.5);
    --check-color: rgba(255, 0, 0, 0.5);
    --cell-size: clamp(40px, 10vmin, 75px);
    --anim-duration: 0.5s; 
}

html, body {
    min-height: 100vh; 
    width: 100%;
    margin: 0;
    padding: 0;
}

body {
    background-color: var(--near-black);
    color: #EAEAEA;
    font-family: 'Manrope', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center; 
    background-image:
        linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
    background-size: 60px 60px;
    animation: moveGrid 1.2s linear infinite;
    overflow-x: hidden;
    position: relative;
}

@keyframes moveGrid { from { background-position: 0 0; } to { background-position: 0 -120px; } }

/* Solana Snowfall Background */
.solana-snowflake {
    position: fixed;
    top: -50px;
    width: 30px;
    height: 30px;
    background-image: url('solana_logo.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    pointer-events: none;
    z-index: 0;
    opacity: 0.7;
    filter: brightness(0.8) drop-shadow(0 0 5px rgba(147, 112, 219, 0.5));
    animation: snowfall linear forwards;
}

@keyframes snowfall {
    0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
    }
    10% {
        opacity: 0.7;
    }
    90% {
        opacity: 0.7;
    }
    100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
    }
}

main#game-container{display:flex;flex-direction:column;align-items:center;width:100%;max-width:1600px;padding:1rem;box-sizing:border-box;opacity:0;animation:fadeIn .8s ease-out forwards;position:relative;z-index:1}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* ADD THIS: Position the animation layer relative to the game container */
#animation-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1000;
}

#game-core-container{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:clamp(1rem,2vh,1.5rem);width:100%;box-sizing:border-box}
#top-section{width:100%;max-width:800px;text-align:center}
h1{font-size:clamp(2rem,8vw,3.5rem);font-weight:800;margin:0;color:#fff;letter-spacing:4px;text-transform:uppercase;animation:auroraGlow 6s ease-in-out infinite}
@keyframes auroraGlow{0%,100%{text-shadow:0 0 20px rgba(153,69,255,.8),0 0 30px rgba(153,69,255,.6)}50%{text-shadow:0 0 25px rgba(255,255,255,.8),0 0 35px rgba(255,255,255,.8)}}
.subtitle{color:var(--primary-purple);font-weight:700;font-size:clamp(.8rem,3vw,1rem);letter-spacing:2px;text-transform:uppercase;opacity:.8}
#game-status{position:relative;background-color:var(--card-black);border:1px solid var(--primary-purple);border-radius:50px;margin-top:1rem;text-align:center;overflow:hidden;margin-left:auto;margin-right:auto;animation:pulseGlowStatus 3s ease-in-out infinite;width:clamp(300px,90%,450px);height:50px;display:flex;align-items:center;justify-content:center;padding:0 1.5rem;box-sizing:border-box}
@keyframes pulseGlowStatus{0%,100%{box-shadow:0 0 10px -2px var(--primary-purple)}50%{box-shadow:0 0 15px 0 var(--primary-purple)}}
#game-status span{position:relative;z-index:1;color:var(--primary-purple);font-family:'Roboto Mono',sans-serif;font-size:clamp(.8rem,3vw,1rem);text-transform:uppercase;letter-spacing:1.5px;text-shadow:0 0 8px rgba(147,112,219,.5)}

.boards-container{display:flex;flex-direction:row;align-items:center;justify-content:center;width:100%;gap:clamp(.5rem,1.5vw,1rem)}
.board{display:flex;flex-direction:column;align-items:center; position: relative;}
.grid{display:grid;grid-template-columns:repeat(8,var(--cell-size));grid-template-rows:repeat(8,var(--cell-size));border-radius:8px;border:3px solid rgba(255,255,255,.2);box-shadow:0 10px 30px rgba(0,0,0,.4);overflow:hidden;background-image:url(board.svg);background-size:cover;background-position:center;position:relative}
.square{display:flex;justify-content:center;align-items:center;cursor:pointer;position:relative;transition:background-color .2s;overflow:hidden}
.square.light{background-color:#3b1b033b}
.square.dark{background-color:var(--dark-square)}
.square::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;background:radial-gradient(circle,rgba(255,255,255,.25) 0,transparent 70%);border-radius:50%;transform:translate(-50%,-50%);transition:width .3s ease-out,height .3s ease-out;z-index:1}
.square:hover::before{width:200%;height:200%}
.square .piece{width:85%;height:85%;background-size:contain;background-repeat:no-repeat;background-position:center;pointer-events:none;z-index:2;transition:transform .2s ease-out}
.square:hover .piece{transform:translateY(-4px)}
.square.selected{background-color:var(--highlight-color)!important}
.square.in-check::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;box-shadow:inset 0 0 25px 5px var(--check-color);animation:pulseCheck 1.5s infinite;pointer-events:none}
@keyframes pulseCheck{0%,100%{opacity:.7}50%{opacity:1}}
.valid-move-indicator{position:absolute;width:30%;height:30%;background-color:rgba(147,112,219,.5);border-radius:50%;pointer-events:none;z-index:3}
.valid-capture-indicator{position:absolute;width:90%;height:90%;border:4px solid rgba(147,112,219,.5);border-radius:50%;box-sizing:border-box;pointer-events:none;z-index:3}

/* --- ENHANCED TROPHY ROOM STYLES WITH BETTER MOBILE LAYOUT --- */
.captured-pieces-container {
    width: calc(var(--cell-size) * 3);
    height: calc(8 * var(--cell-size) + 6px);
    display: flex;
    flex-direction: column;
    padding: 1rem;
    box-sizing: border-box;
    background-color: var(--card-black);
    border-radius: 12px;
    border: 1px solid rgba(147, 112, 219, 0.2);
    transition: all 0.3s ease;
}
.captured-pieces-container.hidden-on-mobile {
    display: none !important;
}
.captured-pieces-container h2 {
    text-align: center;
    font-size: .8rem;
    text-transform: uppercase;
    color: var(--primary-purple);
    margin: 0 0 1rem 0;
    flex-shrink: 0;
}
.captured-pieces {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(8, 1fr);
    gap: 8px;
    width: 100%;
    flex-grow: 1;
}
.capture-slot {
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 6px;
    background: linear-gradient(135deg, 
        rgba(0,0,0,0.3) 0%, 
        rgba(50,50,50,0.1) 100%);
    box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.5),
        0 1px 0 rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.05);
    transition: all 0.3s ease;
}
.capture-slot:hover {
    background: linear-gradient(135deg, 
        rgba(50,50,50,0.2) 0%, 
        rgba(100,100,100,0.1) 100%);
    box-shadow: 
        inset 0 2px 8px rgba(0,0,0,0.3),
        0 0 15px rgba(147, 112, 219, 0.3);
}
.king-slot {
    grid-column: 1 / -1;
}
.captured-piece {
    width: 80%;
    height: 80%;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    opacity: 0;
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
    transition: transform 0.3s ease;
}
.captured-piece:hover {
    transform: scale(1.1);
}
.captured-piece.materialize {
    animation: materialize-in-slot 0.6s cubic-bezier(0.2, 1, 0.2, 1) forwards;
}
@keyframes materialize-in-slot {
    0% { 
        opacity: 0; 
        transform: scale(3) rotate(-180deg); 
        filter: brightness(5) blur(10px) drop-shadow(0 0 20px white);
    }
    60% { 
        opacity: 1; 
        transform: scale(0.8) rotate(20deg); 
        filter: brightness(1.8) blur(2px) drop-shadow(0 0 10px gold);
    }
    80% { 
        transform: scale(1.1) rotate(-5deg); 
        filter: brightness(1.2) blur(0) drop-shadow(0 0 5px white);
    }
    100% { 
        opacity: 1; 
        transform: scale(1) rotate(0); 
        filter: brightness(1) drop-shadow(0 0 3px rgba(255, 255, 255, 0.6));
    }
}

/* Enhanced capture animations */
.piece-captured-glitch {
    animation: glitch 0.8s steps(2, end) forwards;
}

@keyframes glitch {
    0% { 
        transform: translate(0); 
        filter: brightness(1);
        opacity: 1;
    }
    15% { 
        transform: translate(-8px, 8px) scale(1.1);
        filter: brightness(3) contrast(2) hue-rotate(90deg);
    }
    30% { 
        transform: translate(8px, -8px) rotate(5deg);
        clip-path: polygon(0 20%, 100% 20%, 100% 80%, 0 80%);
    }
    45% { 
        transform: translate(-8px, -8px) scale(0.9) rotate(-5deg);
        filter: brightness(1.5) drop-shadow(0 0 8px #fff);
    }
    60% { 
        transform: translate(8px, 8px);
        clip-path: polygon(20% 0, 80% 0, 80% 100%, 20% 100%);
    }
    80% {
        transform: translate(0) scale(0.3) rotate(0);
        filter: brightness(5) blur(2px);
        opacity: 0.3;
    }
    100% { 
        transform: translate(0) scale(0);
        filter: brightness(10);
        opacity: 0;
    }
}

.piece-siphon-clone {
    filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.8)) 
            hue-rotate(0deg)
            brightness(1.2);
    animation: siphonPulse 0.8s ease-in-out infinite alternate;
}

@keyframes siphonPulse {
    from { 
        filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6)) 
                hue-rotate(0deg)
                brightness(1.2);
    }
    to { 
        filter: drop-shadow(0 0 20px rgba(255, 223, 0, 0.8)) 
                hue-rotate(20deg)
                brightness(1.5);
    }
}

.slot-sparkle {
    position: relative;
    overflow: hidden;
}

.slot-sparkle::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, 
        rgba(255,255,255,0.8) 0%, 
        rgba(255,255,255,0.4) 30%, 
        transparent 70%);
    animation: sparkleFlash 0.6s ease-out;
    z-index: 1;
}

@keyframes sparkleFlash {
    0% { transform: scale(0.3); opacity: 0; }
    50% { opacity: 1; }
    100% { transform: scale(1.2); opacity: 0; }
}

/* FINAL ANIMATION STYLES */
/* ADD THIS: Style for the animated piece clone */
.piece-sliding {
    position: absolute; /* Positioned within the animation layer */
    pointer-events: none;
    transition: none !important;
    z-index: 1001; /* Ensure it's on top */
}

.square-landing-effect::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 8px;
    z-index: 1;
    animation: landing-pulse 0.4s ease-out;
    pointer-events: none;
}

@keyframes landing-pulse {
    0% {
        box-shadow: inset 0 0 0 0 rgba(147, 112, 219, 0);
        background-color: transparent;
    }
    50% {
        box-shadow: inset 0 0 0 15px rgba(147, 112, 219, 0.4);
        background-color: rgba(147, 112, 219, 0.1);
    }
    100% {
        box-shadow: inset 0 0 0 30px transparent;
        background-color: transparent;
    }
}

/* Subtle glow effect for moving pieces */
.piece-sliding-glow {
    filter: drop-shadow(0 0 5px rgba(147, 112, 219, 0.5)) 
            brightness(1.05);
}

#bottom-section{display:flex;justify-content:center;gap:.75rem;width:100%;margin-top:1rem}
#action-buttons-container{display:flex;gap:.75rem}
.btn{padding:.75em 1.5em;font-family:'Roboto Mono',sans-serif;font-size:1rem;font-weight:500;text-transform:uppercase;cursor:pointer;border:1px solid transparent;border-radius:12px;transition:all .3s ease}
.btn--primary{background-color:var(--primary-purple);color:#fff;border-color:var(--primary-purple)}
.btn--primary:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,.2)}
.btn--secondary{background:0 0;color:#fff;border:1px solid rgba(255,255,255,.3)}
.btn--secondary:hover{transform:translateY(-3px)}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}

.hidden{display:none!important}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center;z-index:1000;opacity:0;animation:fadeIn .3s forwards}
.modal-content{background-color:var(--card-black);padding:2rem;border-radius:12px;text-align:center;border:1px solid var(--primary-purple);box-shadow:0 0 25px 0 var(--primary-purple)}
.modal-content h3{margin:0 0 1.5rem 0;font-size:1.5rem}
#promotion-choices{display:flex;gap:1rem}
.promotion-piece{width:80px;height:80px;background-size:contain;cursor:pointer;transition:transform .2s ease}
.promotion-piece:hover{transform:scale(1.1)}
#game-over-modal .btn{margin-top:1rem}

/* IMPROVED MOBILE RESPONSIVENESS */
@media(max-width: 900px){
    :root{--cell-size:clamp(35px,11vw,50px)}
    
    .boards-container{
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .captured-pieces-container{
        flex-direction: row;
        align-items: center;
        width: calc(8 * var(--cell-size) + 6px);
        height: auto;
        padding: 0.5rem;
        margin: 0.5rem 0;
        min-height: 60px;
    }
    
    .captured-pieces-container.hidden-on-mobile {
        display: none !important;
    }
    
    .captured-pieces-container:not(.has-captured-pieces) {
        opacity: 0.3;
        border: 1px dashed rgba(147, 112, 219, 0.3);
    }
    
    .captured-pieces-container h2{
        margin: 0 0.5rem 0 0;
        writing-mode: vertical-rl;
        text-orientation: mixed;
        font-size: 0.7rem;
    }
    
    .captured-pieces{
        grid-template-columns: repeat(8, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 4px;
        flex-grow: 1;
    }
    
    .captured-piece{
        width: calc(var(--cell-size) * 0.6);
        height: calc(var(--cell-size) * 0.6);
    }
    
    .king-slot {
        grid-column: span 2;
    }
    
    #white-captured{
        order: -1;
    }
    
    #black-captured{
        order: 1;
    }
    
    #action-buttons-container {
        flex-direction: column;
        width: 100%;
        max-width: 300px;
    }
    
    .btn {
        width: 100%;
    }
}

/* Extra small screens */
@media(max-width: 480px){
    :root{--cell-size:clamp(30px,10vw,40px)}
    
    main#game-container {
        padding: 0.5rem;
    }
    
    .captured-pieces-container {
        width: calc(8 * var(--cell-size) + 2px);
        padding: 0.25rem;
    }
    
    .captured-pieces-container h2 {
        font-size: 0.6rem;
        margin: 0 0.25rem 0 0;
    }
    
    .captured-piece {
        width: calc(var(--cell-size) * 0.5);
        height: calc(var(--cell-size) * 0.5);
    }
    
    /* Reduce snowfall on very small screens */
    .solana-snowflake {
        width: 20px;
        height: 20px;
    }
}

/* Add these new styles to your existing style.css file */

#animation-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Allows clicks to pass through to the board */
    z-index: 1000;
    overflow: hidden; /* Ensures pieces don't animate outside the game area */
}

.piece-sliding {
    position: absolute; /* Crucial for positioning within the animation layer */
    pointer-events: none;
    transition: none !important; /* Disables any interfering transitions */
    z-index: 1001; /* Make sure it's on top of everything */
}

/* Add these new styles to your existing style.css file */


.board {
    position: relative; /* This is necessary for the animation layer's positioning */
}

/* Add these styles to your existing style.css file */

.board {
    position: relative; /* This is the key to localizing coordinates */
}

#animation-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1000;
}

.piece-sliding {
    position: absolute;
    pointer-events: none;
    transition: none !important;
    z-index: 1001;
}
